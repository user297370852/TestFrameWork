# 种子程序构建规约说明文档
## 概述

本文档详细说明了用于开源Fuzz工具输入的种子程序集的构建规约和文件结构要求。种子程序作为Fuzz测试的输入，需要遵循严格的文件结构和程序形式要求。

## 1. 种子程序集目录结构规约

### 1.1 基本目录结构

种子程序集的根目录名称为 `{seeds}`，其标准目录结构如下：

```
seeds/
├── out/
│   └── production/
│       └── seeds/
│           ├── package_name1/
│           │   └── classfile1.class
│           ├── package_name2/
│           │   └── classfile2.class
│           ├── ...
│           ├── no_package_classfile1.class
│           ├── no_package_classfile2.class
│           └── ...
├── skipclass.txt
└── testcases.txt
```

### 1.2 示例结构

以 `/Users/yeliu/PycharmProjects/PythonProject/src/sample` 为例：

```
sample/
├── out/
│   └── production/
│       └── sample/
│           ├── a1b2c3d4/
│           │   └── A1B2C3D4.class
│           ├── io/
│           │   └── IO.class
│           ├── programsofjava/
│           │   ├── PrimeNumber.class
│           │   └── ArmstrongNumber.class
│           ├── p_3.class
│           ├── p_5.class
│           └── ...
├── skipclass.txt
└── testcases.txt
```

## 2. 字节码文件组织规约

### 2.1 类文件存放路径

所有编译后的Java类文件必须存放在 `seeds/out/production/{seeds}/` 目录下。

### 2.2 包名处理规则

1. **有包名的Java类**：
   - 类文件应按照包名创建相应的目录结构
   - 格式：`package_name/主类名.class`
   - 例如：`programsofjava/PrimeNumber.class`

2. **无包名的Java类**：
   - 类文件直接存放在根目录下
   - 格式：`主类名.class`
   - 例如：`p_3.class`

### 2.3 字节码版本要求

- **编译器版本**：必须使用 JDK 1.8 (Java 8) 进行编译
- **字节码版本**：52
- **编译命令示例**：
  ```bash
  javac -source 1.8 -target 1.8 ClassName.java
  ```

## 3. 配置文件说明

### 3.1 跳过类文件列表 (skipclass.txt)

#### 3.1.1 文件位置
位于种子程序集根目录下：`seeds/skipclass.txt`

#### 3.1.2 文件格式
- 每行一个类名
- 有包名的类需包含完整包名路径
- 无包名的类直接写类名

#### 3.1.3 格式示例
```
a1b2c3d4.A1B2C3D4
lock.ReentrantLockTest
programsofjava.Duplicate
programsofjava.ReverseString
cpudisorderrun.DisOrderRun
p_3
```

#### 3.1.4 命名规范
- **有包名类**：`package_name.ClassName`
- **无包名类**：`ClassName`

### 3.2 测试用例列表 (testcases.txt)

#### 3.2.1 文件位置
位于种子程序集根目录下：`seeds/testcases.txt`

#### 3.2.2 文件格式
- 每行一个类名
- 有包名的类需包含完整包名路径
- 无包名的类直接写类名
- 文件末尾不允许有空行

#### 3.2.3 格式示例
```
programsofjava.PrimeNumber
uuid.Code16CharsGenerate
leetcode.ReplaceOneCharOnce2TargetWord
programsofjava.ArmstrongNumber
programsofjava.PrintingTriangle
p_3
```

## 4. 种子程序代码规约

### 4.1 程序结构要求

#### 4.1.1 基本要求
种子程序本质上属于**单元测试用例**或**最小复现代码**，必须满足以下要求：

1. **单一主类**：每个Java源文件只能包含一个主类
2. **文件名一致性**：主类名必须与文件名相同
3. **main方法**：主类必须包含 `public static void main(String[] args)` 方法
4. **独立可执行**：编译后的每个 `.class` 文件都可以直接使用 `java` 命令执行

#### 4.1.2 代码示例

以下是一个符合规约的完整示例：

```java
package io;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;

public class IO {
    private static final String filePath = "a.txt";

    private void writeFile() throws IOException {
        DataOutputStream var1 = new DataOutputStream(new FileOutputStream(new File("a.txt")));
        var1.write(65);
        var1.writeInt(10);
        var1.writeBoolean(true);
        var1.writeByte(-1);
        var1.writeChar(66);
        var1.writeChars("中国");
        var1.writeUTF("中国");
        var1.writeDouble(20.1);
        var1.writeFloat(10.2F);
        var1.writeLong(100000000L);
        var1.close();
    }

    private void readFile() throws IOException {
        DataInputStream var1 = new DataInputStream(new FileInputStream(new File("a.txt")));
        System.out.println(var1.read());
        System.out.println(var1.readInt());
        System.out.println(var1.readBoolean());
        System.out.println(var1.readByte());
        System.out.println(var1.readChar());
        System.out.println(var1.readChar());
        System.out.println(var1.readChar());
        System.out.println(var1.readUTF());
        System.out.println(var1.readDouble());
        System.out.println(var1.readFloat());
        System.out.println(var1.readLong());
        var1.close();
    }

    public static void main(String[] var0) throws IOException {
        (new IO()).writeFile();
        (new IO()).readFile();
    }
}
```

### 4.2 编译要求

#### 4.2.1 编译环境
- **JDK版本**：Oracle JDK 1.8 或 OpenJDK 1.8
- **编译器**：javac
- **目标字节码版本**：52

#### 4.2.2 编译步骤

1. **创建目录结构**：
   ```bash
   mkdir -p seeds/out/production/seeds
   ```

2. **编译Java源文件**：
   ```bash
   # 有包名的类
   javac -source 1.8 -target 1.8 -d seeds/out/production/seeds package_name/ClassName.java
   
   # 无包名的类
   javac -source 1.8 -target 1.8 -d seeds/out/production/seeds ClassName.java
   ```

3. **验证编译结果**：
   ```bash
   # 验证类文件可执行
   cd seeds/out/production/seeds
   java package_name.ClassName
   java ClassName  # 无包名类
   ```

## 5. 质量保证要求

### 5.1 代码质量

#### 5.1.1 可编译性
- 所有Java源文件必须能够使用JDK 1.8成功编译
- 编译过程中不能有警告或错误

#### 5.1.2 可执行性
- 编译后的每个类文件必须能够独立运行
- 运行时不能有未处理的异常（程序预期的异常除外）

#### 5.1.3 代码规范
- 遵循Java标准编码规范
- 类名使用Pascal命名法
- 方法名和变量名使用camelCase命名法

### 5.2 文件完整性

#### 5.2.1 必需文件
种子程序集必须包含以下文件：
- `out/production/{seeds}/` 目录及其下的所有 `.class` 文件
- `skipclass.txt`（可为空文件）
- `testcases.txt`

#### 5.2.2 文件权限
- 所有文件必须具有可读权限
- `.class` 文件不应具有写权限（防止意外修改）

## 6. 常见问题及解决方案

### 6.1 编译问题

#### 6.1.1 字节码版本不兼容
**问题**：使用高版本JDK编译导致字节码版本过高
**解决方案**：
```bash
javac -source 1.8 -target 1.8 ClassName.java
```

#### 6.1.2 包名路径错误
**问题**：有包名的类编译后路径不正确
**解决方案**：
```bash
javac -source 1.8 -target 1.8 -d target_directory package/name/ClassName.java
```

### 6.2 运行问题

#### 6.2.1 找不到主类
**问题**：java命令执行时报"找不到主类"
**解决方案**：
- 检查类文件路径是否正确
- 确认类名与文件名一致
- 验证main方法签名是否正确

#### 6.2.2 NoClassDefFoundError
**问题**：运行时找不到依赖类
**解决方案**：
- 确保所有依赖类都在classpath中
- 检查包名是否正确

## 7. 验证清单

### 7.1 结构验证
- [ ] 种子程序集根目录命名为 `{seeds}`
- [ ] 存在 `out/production/{seeds}/` 目录
- [ ] 存在 `skipclass.txt` 文件
- [ ] 存在 `testcases.txt` 文件

### 7.2 编译验证
- [ ] 所有Java源文件使用JDK 1.8编译
- [ ] 字节码版本为52
- [ ] 编译过程无警告和错误

### 7.3 运行验证
- [ ] 每个 `.class` 文件可独立运行
- [ ] 运行结果符合预期
- [ ] 无运行时异常

### 7.4 配置文件验证
- [ ] `testcases.txt` 格式正确，无空行
- [ ] `skipclass.txt` 格式正确
- [ ] 类名与实际文件匹配

## 8. 工具使用

### 8.1 编译工具
项目提供了辅助编译工具 `ToJava.py`，可用于批量转换 `.class` 和 `.jimple` 文件为 `.java` 文件。

### 8.2 使用示例
```bash
python src/tools/ToJava.py input_directory --output output_directory
```

## 9. 注意事项

1. **严格遵循规约**：任何偏离规约的种子程序都可能导致Fuzz工具无法正常工作
2. **版本一致性**：确保所有程序使用相同的JDK版本编译
3. **测试充分**：每个种子程序都应该经过充分的测试验证
4. **文档更新**：如规约发生变化，需及时更新本文档

---

**版本信息**：v1.0  
**最后更新**：2025年12月  
**维护者**：Liu 
